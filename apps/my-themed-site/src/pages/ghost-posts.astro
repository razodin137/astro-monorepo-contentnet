---
import { getSiteContent } from '@my-network/api';
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import type { MetaData } from '~/types';

const metadata: MetaData = {
  title: 'Ghost Posts',
  description: 'Latest posts from Ghost CMS, filtered by site tag.',
};

const posts = await getSiteContent();
const siteTitle = import.meta.env.SITE_TITLE || 'Ghost Posts';
---

<Layout metadata={metadata}>
  <Hero
    tagline="Content from Ghost"
    title="Ghost Posts"
    subtitle={`Showing ${posts.length} posts tagged with "${import.meta.env.SITE_TAG || 'default'}"`}
  />

  <section class="px-4 py-16 sm:px-6 mx-auto lg:px-8 lg:py-20 max-w-6xl">
    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-xl text-muted">No posts found for this site's tag.</p>
        <p class="text-sm text-muted mt-2">
          Make sure your Ghost CMS has posts tagged with: <code class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">{import.meta.env.SITE_TAG}</code>
        </p>
      </div>
    ) : (
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {posts.map((post: any) => (
          <article class="bg-white dark:bg-slate-900 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
            {post.feature_image && (
              <img 
                src={post.feature_image} 
                alt={post.title}
                class="w-full h-48 object-cover"
              />
            )}
            <div class="p-6">
              <h2 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">
                {post.title}
              </h2>
              {post.excerpt && (
                <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-3">
                  {post.excerpt}
                </p>
              )}
              <div class="mt-4 flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                <span>{new Date(post.published_at).toLocaleDateString()}</span>
                {post.reading_time && <span>{post.reading_time} min read</span>}
              </div>
            </div>
          </article>
        ))}
      </div>
    )}
  </section>
</Layout>
